using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ALE_filter
{
    class ALE
    {

        private int coeffNumber;
        private int SNR;
        private int N;
        private double mu;
        private double funFreq;
        public double samplingFreq;

        public double[] timeBuffer;
        public double[] inputBuffer;
        public double[] cleanInputBuffer;
        public double[] noiseBuffer;
        public double[] outputBuffer;
        public double[] errorBuffer;
        public double[] coeffBuffer;
        public double[] filterInputBuffer;
        private double[] circularInputBuffer;
        public double maximumTime;

        private double[] grandBuffer = new double[] {
        -0.6271571808400241,
        -0.08900511701933034,
        -0.27694515517527135,
        1.0104588142024888,
        1.244506545910743,
        -0.5900743530491783,
        2.47413094609335,
        -1.5924877511306201,
        -0.30996357021982157,
        -0.5789516893655811,
        -1.3023873694265768,
        -0.4736055987015604,
        -0.11933128726276276,
        -0.7659886547203956,
        -1.1780593422060557,
        1.037067321589488,
        -0.4142952701932804,
        0.733359971139491,
        1.0266922111995829,
        1.6259631580904488,
        -0.5320272198372951,
        -1.3281929902010217,
        -0.4991958170080351,
        -0.9550790206674145,
        -0.6771158445523403,
        0.842254635184862,
        0.4614664811767928,
        -0.38675473070164357,
        -2.1078701006867577,
        -0.6632475321496925,
        0.6208900572476883,
        -0.1855983235056357,
        -1.777056811550905,
        0.6433935737266544,
        1.1406621225181985,
        -0.3786043767040861,
        1.632711264963671,
        0.4759996019217215,
        -0.8247402082149868,
        -0.9037704790990337,
        -0.9030159367903339,
        1.023173585792971,
        -0.4835074971782185,
        -0.9987069151106591,
        0.9886220994053736,
        0.4238371586644928,
        0.26797714678119794,
        -0.8619773360929289,
        0.36768526260686846,
        0.3554067114727087,
        -0.9623387178425598,
        -2.335874851349171,
        -1.9821710072947734,
        1.377021956526509,
        0.7554887567651977,
        -1.2580558071748693,
        -0.4842598734354081,
        -0.10144638447809451,
        0.015719261373328068,
        0.7714226921751677,
        -0.4273610810673213,
        0.006416793756060794,
        0.3231488773009496,
        -0.32145817930713894,
        0.6168156835222202,
        -1.1201992227001116,
        0.5862970000059643,
        -0.5947782308765092,
        0.2956233987021381,
        2.468089516574686,
        0.3765674321457043,
        -0.9175089130553435,
        0.6258895253493203,
        -0.7989220621845767,
        0.5810858034376937,
        0.6792432611313329,
        0.02172903093998673,
        -0.19264101620296198,
        0.2552262869793595,
        -0.09495015286925568,
        1.008745579496802,
        -0.645133322138828,
        0.20105166227356594,
        -2.3622195555108654,
        -0.5300451665078368,
        1.1607885558189208,
        0.862099875424874,
        0.32349582960718587,
        -0.23220143140898497,
        -0.9441600852909757,
        -0.19602138734239033,
        -0.414618436930665,
        0.4082174542662672,
        1.8634359326242418,
        0.7076150984111017,
        -0.23035997379768675,
        0.603832353096687,
        -0.5338480652236366,
        1.5035966181582656,
        0.24241898621845073,
        -0.05666263363716331,
        -0.4629316155673372,
        -0.7049821832798157,
        0.4044242956106886,
        -0.5928259451359774,
        -0.8443218061277297,
        0.10138940870785107,
        0.3404622461257509,
        -0.46523970565643,
        -0.49008479464641225,
        -0.16591201120301308,
        -1.8268702046382794,
        -0.2510436903070004,
        -0.5278957311498784,
        0.3257376444545025,
        -0.09320876962494318,
        0.1556212496229561,
        -1.7450751546053331,
        -0.48696745629502713,
        -0.40383276137631097,
        -1.2405941572596357,
        -0.024521545960943185,
        -0.21529111735750292,
        0.6466104890994295,
        1.2152209464624617,
        0.8879528856646048,
        0.6320666414301385,
        -1.4075118402957376,
        1.0302132657393854,
        0.20821130087093223,
        1.7074105015680379,
        -0.8960848530808585,
        -0.8853312213207117,
        -0.20836610797340263,
        -0.17224903400523933,
        -0.3822677599667864,
        -2.1217701167297705,
        -0.5676388254848885,
        1.5938822850501995,
        -1.3988105165286608,
        1.2288032959457906,
        -0.247069725513592,
        0.9612638385702751,
        1.9311142803790347,
        -1.6573011549647356,
        0.7521290875294021,
        0.6382316495269571,
        0.2342769582031824,
        0.3488521814326017,
        0.21032256351027936,
        -0.6657777073731455,
        1.3636247644904083,
        -0.37648458988458694,
        0.007848517939626758,
        0.050711247722381364,
        -0.09849684408205006,
        -0.9975354131338212,
        0.577912882740732,
        -1.174867358588508,
        -0.7332462660479719,
        0.1909546989674093,
        -0.30143607999950633,
        -1.12087073760097,
        0.588970393577012,
        0.6425316043172798,
        -2.715845765945673,
        0.2962144934129673,
        -1.0851846010160346,
        -0.0654226479447039,
        2.177268245238477,
        -1.1204032202746974,
        1.331325177947242,
        -0.6779017794204873,
        -0.04986521423482679,
        -0.44125346622508055,
        -0.2775015798106308,
        0.14099449264972064,
        1.4096915183676162,
        0.23123350422060857,
        -1.527843168870655,
        1.202007140343901,
        -0.3268390598126982,
        -2.821774601866828,
        0.4082257939313757,
        0.41426294350544113,
        0.4359329601678784,
        2.3659130918667888,
        -1.0152159457233423,
        -2.136455588302216,
        -0.2520474065708109,
        0.6849965531170238,
        -0.11459084627502125,
        0.5789797504825533,
        0.23287610101668588,
        1.6029287194530364,
        0.321432381566181,
        0.6905886020295348,
        0.6426053076241786,
        0.893591903846011,
        -0.7744717484740912,
        -0.5283239904651376,
        1.8577152733418194,
        -1.097853151233192,
        -0.17116173624114123,
        -0.35775957343249276,
        -0.5700089094122274,
        -0.3352070056792507,
        0.6847380316693136,
        0.4187245785033348,
        1.6423311371463534,
        1.4368897666571874,
        -0.2773934424082178,
        -0.26051853942804254,
        -0.25829745188280734,
        -0.1943141816397586,
        -0.7279084551426068,
        -1.4307425658170043,
        0.3563663304968255,
        -0.08027243615134683,
        -1.3494635038531528,
        0.5687825479274555,
        -0.3102968589457131,
        1.1490279991170549,
        -1.1492750113093662,
        0.22387130101192484,
        0.1782997069313898,
        -0.5209619621997453,
        -1.5671405932204774,
        -2.502737546793503,
        0.23627624129375036,
        -0.2509481354432133,
        -0.0010054521469023345,
        0.6598658195405555,
        -0.7546845192798394,
        -1.8621954448892648,
        -0.42930786778012886,
        1.5179281043537973,
        0.21477825493044175,
        -0.6994092441367673,
        -1.9883276934320275,
        -0.8794845249568602,
        -0.7582946201205351,
        0.5727850374714527,
        -0.5844725722814604,
        -0.8730655635169388,
        0.21379345328563096,
        1.9270982055119432,
        -0.49671643089495965,
        -0.5376684493809614,
        0.2818261705607288,
        0.3243531261832643,
        0.4144188058313557,
        1.0946455857494306,
        2.929281681988286,
        -0.2783964988043153,
        -0.958799789431908,
        1.9089071951041594,
        0.629327698422282,
        -1.3579169479379767,
        -0.3225682171145476,
        0.13242560849482055,
        2.4557673673547193,
        -0.3133948641318053,
        1.4507890064095235,
        -1.4264564734847653,
        0.9854838498623186,
        0.3605100439102218,
        -1.8264432528813686,
        0.23845474884067255,
        1.0236864110990518,
        -1.4260937464895131,
        -1.5130045533588894,
        -0.8201429972495614,
        -1.2592570357748207,
        -0.9755148265909194,
        1.339601717620873,
        0.40150088600715167,
        -0.11885075522345323,
        -0.755329511850115,
        -1.250087740278235,
        0.2875799619277946,
        0.5488112645286924,
        -0.750079879976425,
        0.6910268381883151,
        -0.9901447345211718,
        0.19426780163574625,
        1.1176114596125881,
        -1.2808421702751427,
        0.48497585606026794,
        -0.36234648010146747,
        0.4235047509929283,
        -0.9795404185485816,
        -0.2940970590308292,
        1.5994895404514509,
        0.45150145097030947,
        -0.06703451298195959,
        -1.4731891569100855,
        -1.237768274084724,
        0.27284004921140587,
        0.4639186734125187,
        1.3954780370657947,
        1.5331683991802523,
        -0.5267293602943073,
        0.22555295826830032,
        -1.018949133736776,
        -0.8552830566796381,
        0.3903719906929853,
        0.26559082790913063,
        -1.4167634802556752,
        -1.3546264910121124,
        1.1945646215078822,
        2.2154540752799035,
        -0.7213415680298633,
        1.6023632814561364,
        0.3881730166712826,
        0.8036747433583056,
        0.1580187280408562,
        0.15666705844730777,
        -0.4938435212803858,
        0.991232722302696,
        1.0373297469966762,
        0.4410953344698304,
        -0.20827330449132744,
        -0.28893346110841706,
        -0.32217569563453624,
        0.5337466099437749,
        -0.07624130269778198,
        -0.9937963470865637,
        0.3726380154518524,
        -1.146382828086208,
        -0.23837707949646728,
        0.12446726720206969,
        0.23926069159421762,
        0.49658389970397837,
        0.4471880945963286,
        0.1976576799192107,
        0.41786144169719497,
        -0.45509872904113324,
        0.3039935064747938,
        -1.2778231005158713,
        -0.37315564451250527,
        0.12126970713186935,
        -1.412147721785403,
        0.09375397726131318,
        -0.5754163151060987,
        1.160033439083775,
        -1.2802147862078952,
        0.9252929029919734,
        0.9465443162926869,
        -0.9119763190785186,
        0.24151783855640355,
        -0.6513665054312903,
        0.7298302802846997,
        -0.3406264338630332,
        0.9226323503880742,
        0.786213102167332,
        1.0919870300832917,
        -2.271009544505824,
        0.4231097057711696,
        0.05161961543660379,
        -0.3972136645608778,
        0.19155424150141315,
        -1.2280741380741427,
        2.3435584771663214,
        -2.1375106788519034,
        -0.14509086053944475,
        1.2874919652084427,
        -0.6046006507049865,
        0.5312145490801548,
        1.1616115343649893,
        0.22346015673762162,
        1.3365183118147566,
        0.057467230326088053,
        1.4054719540120981,
        -1.4113004386615562,
        0.5417567798385536,
        0.7222449142313477,
        -0.7304374360809376,
        0.20772614095783884,
        -1.0196372008680323,
        -0.8027019962761164,
        0.5052238725510488,
        0.2189669915093951,
        -0.2603598846999195,
        0.41966532524088695,
        2.2191684902503503,
        -1.4756448426312252,
        0.9450617745927284,
        2.340745592675618,
        0.11829361422310525,
        -0.978019296409745,
        0.47803576565230643,
        1.1199240770249181,
        0.227376120549564,
        -0.2800632222648751,
        0.6335160524476052,
        -0.11465208161331131,
        0.09806568983900343,
        1.1994240862074248,
        0.24744175480735878,
        0.26991638070572294,
        -0.7178955619088455,
        -1.117180757120186,
        0.48320084624212234,
        2.371504040503016,
        0.3237580730910924,
        -0.8315028686521034,
        -0.1073869111322121,
        0.6051790094397009,
        0.39267548983140743,
        -0.08174711862640582,
        -0.5001001290310231,
        0.3294974211054259,
        1.8841470187087026,
        -0.26374237994553723,
        -0.009552696605762571,
        -0.5772046567531519,
        -1.5860293661493419,
        -0.5871096827553054,
        0.8923220128780608,
        1.2894155504009208,
        1.1319147424737506,
        -0.10355757476566685,
        0.18160034626115257,
        -0.09506615088638803,
        0.9831354756938003,
        0.014214546229720008,
        1.0118017568064048,
        0.5038532160977731,
        -1.0121300513426101,
        -0.7475669506126158,
        -0.8206961497725611,
        0.08977575088763856,
        -1.6142748921261019,
        -1.4291775485082538,
        0.44707327465969304,
        -1.714115023014548,
        0.8072152348142854,
        -0.7578957251334588,
        -0.6799647134420291,
        -0.4953044952053686,
        0.25896080980614106,
        -0.3009871932307837,
        1.2778564391630642,
        0.3431238093258009,
        -0.44606166536476866,
        0.10699981206779163,
        -1.8813068122758818,
        0.5521365572959587,
        0.9031416217721917,
        0.09261298234096393,
        0.569016573965746,
        -0.7108767812696929,
        -0.20002746800835783,
        -1.5279110393217297,
        0.020839087821321427,
        -2.102460819181589,
        -0.7204734226123398,
        0.43187761349581566,
        0.8811805419810254,
        0.6642295986311144,
        -1.0456444209327582,
        -1.0235534387893965,
        0.7721962937206863,
        -1.5887051113930823,
        -1.0725941706554694,
        -0.3112410998892732,
        1.2853157985455288,
        -0.608587531143991,
        0.08868911476725394,
        -0.180768726367387,
        0.978512216673693,
        0.7736451728694566,
        0.39017939460347006,
        0.6309908200021482,
        0.35228459347355184,
        -1.603238195347414,
        0.4549008517048303,
        0.5331353634884802,
        -0.7932396499825,
        -0.4326182752481914,
        0.4012376854061286,
        -0.17614241307034856,
        1.1078039271591098,
        -1.2558660973039886,
        0.29339407264937817,
        -0.34497790367282793,
        -0.28361311823436536,
        -1.0569488891033476,
        -0.45723352048540344,
        -0.467509907139798,
        0.6752722851795204,
        0.0957268290246216,
        1.6431296970906046,
        -1.0801900308108008,
        -1.1229176666955705,
        1.7139168432858394,
        0.5458975391924148,
        1.275597863959303,
        -1.9211790057972913,
        -0.32901908336706226,
        0.834387752362506,
        -0.8084346996218243,
        -1.1537807462021936,
        1.9999546670704689,
        -0.09376050997272234,
        1.0867686681013307,
        0.2768405953645173,
        1.7886367952786948,
        1.3058673071399929,
        -0.6051436122447048,
        -1.705813828215334,
        0.18127580863925624,
        -0.1574385561371731,
        -0.33693672103960903,
        1.4279112005257812,
        -1.0669803453443731,
        -0.4779747481470782,
        0.38522100164174755,
        0.6706396409081408,
        1.2179313216466783,
        -0.369237892751002,
        0.4727648369595233,
        -1.6342724904192676,
        -0.41805780000629056,
        0.10122694460246562,
        -0.3209037470435247,
        0.1906074755973,
        -1.468109014831366,
        1.1931442972817043,
        0.6292987401013097,
        1.4741636144527133,
        -1.3077623066251265,
        1.4518267656743453,
        -1.9840130416354633,
        1.0314515315383113,
        0.7860636485333223,
        -0.28297784109588836,
        -0.690195362848132,
        0.934554662583603,
        0.4827618921538597,
        -1.360369639663618,
        0.5927106892588996,
        1.173319895211148,
        -0.3676538999332884,
        -1.1727072309618949,
        -0.6837671744273063,
        -1.0909937488807295,
        0.7568685796967046,
        -0.6901991084834497,
        -0.1965942202485927,
        -1.4445827723184905,
        0.09884337333658466,
        0.5310977849920339,
        0.9536637798088046,
        -1.8344148803343625,
        -1.1755980318286054,
        0.1662204222571802,
        0.53357378718774,
        -0.4314980062459354,
        0.7944348998803351,
        1.2910301249552565,
        -1.1510061471382196,
        -0.18312678071081062,
        -0.7653008861205248,
        -0.5891696437869602,
        0.12778781133167438,
        -0.9046653080023063,
        -0.7709563546595023,
        1.3138690811402403,
        -1.566922419420651,
        -1.4217819272949577,
        1.5449192852689153,
        0.17828368485674978,
        -1.9572527499412473,
        -0.4919389612945118,
        1.318717355515543,
        -2.4087115980779137,
        0.21151652956453001,
        1.2904716366015778,
        0.32078430197906743,
        -1.0605951457575995,
        -1.3547652306726046,
        0.1076095761514152,
        -0.48067223960406413,
        -1.58509443915825,
        1.313907597413999,
        0.7683735481495283,
        0.20175291071751264,
        0.5785080875619264,
        -1.168586009801655,
        0.78111648804826,
        -0.015492213439577567,
        -0.22648188105969838,
        0.6606028503527569,
        0.22969062658838035,
        -0.892363336015467,
        -0.03667085381161144,
        -0.3138660700562427,
        1.1188216694687314,
        -0.2204069833044515,
        -1.0508377734640755,
        -0.9531799655176779,
        0.3827296911602173,
        -0.5931175135583097,
        -0.09432338937059714,
        -1.2702562663838335,
        0.1576211372104514,
        -0.9031802498201977,
        0.5647888803081469,
        -0.25123375992357083,
        -0.735047380838586,
        1.2697907150378396,
        -1.0071015297367758,
        1.0176190457747623,
        -0.2803162451764768,
        -0.7047307606954937,
        1.2407478254362865,
        -2.375012362366645,
        0.7488327577873527,
        0.42915532571386683,
        -0.009058293823582413,
        1.2598250712764862,
        0.9094429880199101,
        0.28726990783155343,
        -2.4601092871255545,
        -0.9290164169327315,
        1.7453174778994498,
        -1.0612339579916608,
        -0.8675697884253374,
        -0.0675762902312104,
        -0.7446444541860107,
        -0.5092846978559105,
        -1.8098992259926856,
        0.8877467916987516,
        0.25297927408816107,
        -0.6816734747458145,
        -1.5809694960190424,
        -0.7560328829281082,
        0.9516494081051285,
        1.147835803950064,
        1.856679418089195,
        1.1354212381721407,
        -0.5239425742082555,
        2.484183637464726,
        2.235306949994669,
        0.7109385939081249,
        -0.2816600435455705,
        0.4015143599704043,
        1.467900443931722,
        -0.3022467612027811,
        -0.9269996238462818,
        -0.9865392341202434,
        0.22789532174875318,
        0.5297868034090243,
        0.6894498107073107,
        0.9848897438677454,
        -1.7349599087817342,
        2.177566119906415,
        0.5508777830842937,
        0.9424480990773088,
        0.03492771134671906,
        -0.9528487319914289,
        -0.9874212926610956,
        -1.7070442827376349,
        1.1774930589619421,
        -0.2876988339327437,
        -0.04063606380218873,
        -0.7658896724253428,
        1.3724227032026413,
        0.2995755836934802,
        0.17376806437314968,
        0.07893501538645953,
        -0.17049472878903832,
        -1.0197843701838347,
        -1.2502780531984647,
        -1.6875496776347476,
        0.1494949818284934,
        -2.2782291629653333,
        -0.4994581793944418,
        0.04599093597393236,
        1.1361256099195005,
        -0.12268879521310638,
        0.3455652994030115,
        -1.2362823381729282,
        1.0143041785907627,
        0.5902068775370733,
        -2.679928616385652,
        0.15763056427840566,
        -1.258690161872713,
        -0.350885019465357,
        1.5980065112977027,
        -1.747487928479858,
        0.9894076306184552,
        -1.5211755525706845,
        -1.4497800902757942,
        0.4898476047670974,
        -0.22778805332733307,
        0.03380135178323989,
        1.6485923749850873,
        0.6512102141805595,
        0.8162052673477007,
        -0.5396163959276357,
        -0.37785056577372156,
        0.7385584438508032,
        -1.0990882629836052,
        -1.205341937623241,
        -0.23618585637123557,
        0.17727052822349437,
        -1.2569369929537644,
        0.5234140931270295,
        -1.2443416076519453,
        -0.9617422766227625,
        0.4472547385169833,
        -0.159047943172057,
        0.7096696531523256,
        0.07408756489022192,
        1.0018004058355972,
        -0.8233186772408365,
        0.009523808221186529,
        -0.5557347381492828,
        -0.09001001771028694,
        -1.4721320524029498,
        1.088326511685399,
        -0.029337907079786833,
        -1.3027365018614345,
        0.7099149602087428,
        0.747427669561653,
        -1.0066450072609938,
        -1.3621821974748785,
        -0.638334063827475,
        1.7105656602283599,
        0.6231236932848573,
        0.5414728829056137,
        -0.5674771428643566,
        -1.3512805250279483,
        -2.0230758329175367,
        -0.22798877749439875,
        -0.22564727606284204,
        1.1700653378689507,
        1.4567330981290316,
        2.85981445356758,
        -0.7925299327015516,
        -1.659011977933961,
        1.2690225307531882,
        -0.2929068212219187,
        -1.59755089906644,
        0.21324520405279832,
        -1.1748737642262972,
        2.587359998688031,
        -2.305988804307745,
        1.724355926786025,
        0.17778649419925413,
        -1.5705492209387728,
        -0.3113215757313216,
        1.1934199996558936,
        -0.13421352908424167,
        -0.8454169788417508,
        -1.3826656076439088,
        -0.36559897733294705,
        -2.6105793719371615,
        0.22550244943696238,
        0.05020730618664279,
        0.6325279934341618,
        1.612167353466658,
        0.24329687221857657,
        0.2446518417722409,
        -0.7366646791853296,
        0.6651865809934824,
        -1.9476173789741367,
        0.2546374652639776,
        0.50416419473892,
        0.6155471788789875,
        2.106001467773554,
        0.7746870523703286,
        1.2482077098900834,
        0.966342699429221,
        0.25971428548310266,
        0.29533459447322935,
        0.18140258562608474,
        -0.34927911495065017,
        -1.2901925495245126,
        -0.3953424459870047,
        -1.4460808817885518,
        -0.4968134633039377,
        0.10767455472863274,
        -2.1124815368270777,
        1.7041647265416808,
        2.023587474951091,
        0.42931115097460315,
        -1.5026548000314877,
        0.054082095455872864,
        -0.18721271844645654,
        -0.47672243949792226,
        0.47470672235235367,
        -0.6765319765566243,
        0.6965479796583091,
        0.12366606865639573,
        -0.6125209477449504,
        0.36383395384860956,
        2.042516975251385,
        1.2905776930254191,
        0.8252758845188551,
        1.2650224553930105,
        0.12437913851967553,
        -0.16048261835893302,
        0.12652958405887116,
        0.38865364926388224,
        0.0576311081208474,
        -0.9469632094442118,
        -0.22885323289348652,
        -1.1943036760836219,
        -1.1804989100560563,
        -0.9166328435535606,
        1.5416259990944559,
        -0.9722635405010117,
        0.9505904146265065,
        -1.0732377047607327,
        -0.13022985007687282,
        0.11105399122025794,
        -2.2325904331194986,
        -1.9180108753560887,
        -0.2895208797157435,
        -0.5907208729556189,
        -0.039804292252552304,
        -0.36264758551328263,
        -0.008307532918075226,
        -1.9344197641721719,
        0.7822842124239539,
        0.23091009723332928,
        0.34535307741211,
        -1.240438559149133,
        -0.16036324903647242,
        0.434213776408907,
        0.4484986500666872,
        0.19638867517693254,
        2.230542328563856,
        -0.12852278199511247,
        -0.7317607589832132,
        0.055638502610280055,
        -0.6121613413129061,
        -0.12329601812058977,
        1.267725753560787,
        -0.7614993873161033,
        -1.0965133093180495,
        -0.7764888003994938,
        -0.12123767347935477,
        0.607636171568016,
        0.19150837638709772,
        -0.029935010032105462,
        -0.1959292811625522,
        -1.2415415119872257,
        0.08265377018729314,
        -0.020380426878648987,
        -0.03793549005119783,
        1.2088694091590702,
        0.7620655522006908,
        -1.653272208463492,
        -2.205495738540189,
        -0.3019745590504545,
        1.518012774483632,
        1.127976021798411,
        -0.43067211409155026,
        0.9546959644173406,
        -1.0474495754062758,
        -0.7388942866692488,
        1.0589712095996067,
        1.4277537506217066,
        -0.312964810058006,
        0.07040682986441607,
        0.061905938976396985,
        0.2547713505959986,
        -1.3989753975170163,
        0.03270146252830213,
        2.046678047541694,
        0.6064407192850337,
        -0.10184223523277247,
        0.9309239325234759,
        -1.9920256821114082,
        -0.3838745615003086,
        0.3122852257106835,
        0.567358452008675,
        1.8820832844081181,
        0.9863526078598481,
        0.7339195999813243,
        -0.09116259088429268,
        1.2539631841444128,
        0.11075865273035157,
        0.010418161597398438,
        0.014481592027117456,
        0.9303219931893004,
        -2.154098715577879,
        -0.1071777901852844,
        -0.47870299287594076,
        0.48654667643222027,
        -0.5878102700656846,
        -1.0939448530826688,
        -1.3177924391385132,
        0.4035912589806273,
        1.3844778038400682,
        0.636398227319413,
        -1.8353733776878367,
        -0.6887377429549718,
        0.5860564026513218,
        2.2968969747347385,
        -0.580640809717602,
        2.2522291912963563,
        -0.5244742902476052,
        1.2926770600455644,
        0.26566059582390517,
        -1.6071836820544638,
        -0.0010353477223659577,
        0.521438596151791,
        -0.8062252858606506,
        0.7102338297198051,
        0.007598386990122656,
        0.19767333424489977,
        0.20611292375267273,
        0.29654521362291797,
        1.064445270987127,
        -0.01733230094848686,
        -0.29320989498383265,
        -1.2219673667991442,
        0.14081551901224443,
        -0.5325924356954648,
        0.21678683970944865,
        -0.6073228279575439,
        -1.4875626347716338,
        0.12446933121385695,
        -1.2545566431390842,
        -0.6042453131691848,
        -0.6609164543170006,
        0.10153287814234668,
        -0.3850977138892702,
        1.8574965187065224,
        0.3317458874668372,
        1.9096569609617213,
        0.7161990764632719,
        -2.3811723408422236,
        -0.90475809634881,
        0.01727898701645208,
        -0.08219651689082474,
        -0.47004219938559955,
        -0.526024649203178,
        -1.5698582168524755,
        1.5263859599637934,
        -0.10880379123944128,
        0.032427684793203064,
        -1.2641211858331158,
        -0.9747705523620848,
        0.43173153377589657,
        0.2949120365372231,
        1.3518975023817497,
        -2.2810158789687396,
        1.2367807650060363,
        -0.8313747158430121,
        -2.001832808140435,
        -0.46695096117138546,
        -2.3776930842088912,
        0.6823883673668597,
        -1.2112709344562278,
        1.6087056789258014,
        -0.07970712347154574,
        2.183002362894126,
        -0.032357977719459745,
        1.4315213066809451,
        -0.9109620107207207,
        1.3334860933612984,
        -0.07238438348381246,
        -0.39754938969563053,
        1.1123223435702583,
        1.9114662555177944,
        -1.1218998568377743,
        0.8482244332928758,
        -1.2897561210331747,
        0.49032989053741777,
        -1.8022910176746372,
        -0.7866807116391039,
        -1.260171272337172,
        -0.6976742834695936,
        -0.1769022880090822,
        -0.29467718535083415,
        -0.10632776291404289,
        0.24390344776304976,
        0.32655694393493284,
        -0.1264451059047873,
        -0.6547984119174746,
        -1.9207662963830856,
        0.3605357849656162,
        -0.670451822044848,
        -0.2871917680330312,
        -1.802216844649875,
        -0.21817954179282126,
        0.6369474243781936,
        -0.1117707684878474,
        -0.9137204831337972,
        -0.6292668052437463,
        -1.7854800036508607,
        1.4102707637685727,
        1.2721433655122265 };   // bufer with white noise (mean = 0, normal distribution = 0.5)

        /// <summary>
        /// Initializes filter
        /// 
        /// </summary>
        public ALE(int order, int signalToNoiseRatio, int numberOfSamples, double convergeStrength, double cleanSignalFreq,  double samplingFreq)
        {
            /// order              - Order of filter
            /// 
            /// signalToNoiseRatio - SNR in dB
            /// 
            /// covergeStrength    - known as mu, should it between 0 and 1/(sigma^2) whre sigma^2 is sum of input power
            /// perfectSignalFreq  - freqency of clean signal

            coeffNumber = order + 1;
            SNR = signalToNoiseRatio;
            N = numberOfSamples;
            mu = convergeStrength / (double)(order+1); //normalized mu
            funFreq = cleanSignalFreq;
            this.samplingFreq = samplingFreq;

            timeBuffer = new double[N];
            cleanInputBuffer = new double[N];
            noiseBuffer = new double[N];
            inputBuffer = new double[N];
            outputBuffer = new double[N];
            errorBuffer = new double[N];
            coeffBuffer = new double[coeffNumber];
            filterInputBuffer = new double[N];
            circularInputBuffer = new double[coeffNumber];

            filterInputBuffer[0] = 0;
            int j = 0;
            for (int i = 0; i < N; i++)
            {
                timeBuffer[i] = (double)i / this.samplingFreq;
                cleanInputBuffer[i] = Math.Cos(2 * Math.PI * funFreq * i / this.samplingFreq);
                noiseBuffer[i] = Math.Sqrt(1.0 / 2.0 / Math.Pow(10.0,(double)SNR / 10.0)) * grandBuffer[j++];
                inputBuffer[i] = cleanInputBuffer[i] + noiseBuffer[i];
                if (i < N - 1)
                    filterInputBuffer[i + 1] = inputBuffer[i];
                if (j == 1000) j = 0;
            }
            maximumTime = timeBuffer[N - 1];
        }

        /// <summary>
        /// Start filtering using circular buffer
        /// </summary>
        public void startFilter()
        {

            int pCircularBuffer = -1;
            int i = 0;
            int j = 0;
            int k1 = 0;
            int k2 = 0;

            for(int m = 1; m < N; m++)
            {
               /*
                * FILTER
                */
                pCircularBuffer++;
                if (pCircularBuffer == coeffNumber) pCircularBuffer = 0;

                i = pCircularBuffer;
                j = 0;

                circularInputBuffer[i] = filterInputBuffer[m];
                outputBuffer[m] = 0;
                while (i >= 0)
                {
                    outputBuffer[m] += circularInputBuffer[i] * coeffBuffer[j];
                    i--; j++;
                }

                i = coeffNumber-1;
                while (i > pCircularBuffer)
                {
                    outputBuffer[m] += circularInputBuffer[i] * coeffBuffer[j];
                    i--; j++;
                }
                //coefficients updating
                errorBuffer[m] = inputBuffer[m] - outputBuffer[m];

                k1 = 0;
                while (k1 <= i)
                {
                    coeffBuffer[k1] += 2 * mu * errorBuffer[m] * circularInputBuffer[i - k1];
                    k1++;
                }
                k2 = 0;
                while (k1 < coeffNumber)
                {
                    coeffBuffer[k1] += 2 * mu * errorBuffer[m] * circularInputBuffer[coeffNumber - 1 - k2];
                    k1++; k2++;
                }
                
            }

        }

    }
}
